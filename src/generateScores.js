/**
 * @param {Object} jsonDataRequest - The json request object with team members and applicants
 * @return {Object} - score for each applicant generated by the generateScore function
 */

export const scoreAllApplicants = (jsonData) => {
  const applicants = jsonData["applicants"];
  const teamMembers = jsonData["team"];

  const averagedWeights = createAverageOfWeightedValues(teamMembers);

  //Format for the return array of objects for all scores
  const completedScores = { scoresForAllApplicants: [] };

  applicants.forEach((applicantObj) => {
    const finalScore = generateScore(applicantObj.attributes, averagedWeights);
    completedScores["scoresForAllApplicants"].push({
      name: applicantObj.name,
      score: finalScore,
    });
  });

  return completedScores;
};

/**
 * @param {Object} attributes - all attributes of a single applicant
 * @param {Object} averagedWeights - averaged weights of each attribute based on the team member attributes
 * @return {Number} - a number between 0-1 generated by weighted attributes
 * Input is the attributes for each applicant and generates a score for them based on attributes
 */
const generateScore = (attributes, averagedWeights) => {

  // Compare each attribute to the averageWeights and how close they are
  attributes.strength =
    parseInt(attributes.strength) - averagedWeights.strength;
  attributes.endurance =
    parseInt(attributes.endurance) - averagedWeights.endurance;
  attributes.intelligence =
    parseInt(attributes.intelligence) - averagedWeights.intelligence;
  attributes.spicyFoodTolerance =
    parseInt(attributes.spicyFoodTolerance) -
    averagedWeights.spicyFoodTolerance;

  if (attributes.strength < 1) {
    attributes.strength *= -1;
  }
  if (attributes.endurance < 1) {
    attributes.endurance *= -1;
  }
  if (attributes.intelligence < 1) {
    attributes.intelligence *= -1;
  }
  if (attributes.spicyFoodTolerance < 1) {
    attributes.spicyFoodTolerance *= -1;
  }

  let finalScore = Object.values(attributes).reduce(
    (accumulator, currentValue) => accumulator + currentValue
  );
  finalScore /= 40;

  finalScore -= 1;

  if (finalScore !== 0) {
    return parseFloat(finalScore.toFixed(3)) * -1;
  } else {
    //perfect compatability
    return 1;
  }
};

/**
 * @param {Object} attributes - attribute values after they have been divided by 10
 * @return {Number} - average of all attributes that is between 0-1
 */
const createAverageOfWeightedValues = (teamMembers) => {
  let intelligence = 0;
  let strength = 0;
  let endurance = 0;
  let spicyFoodTolerance = 0;
  teamMembers.forEach((member) => {
    intelligence = intelligence + member.attributes.intelligence;
    strength = strength + member.attributes.strength;
    endurance = endurance + member.attributes.endurance;
    spicyFoodTolerance =
      spicyFoodTolerance + member.attributes.spicyFoodTolerance;
  });
  intelligence /= teamMembers.length;
  strength /= teamMembers.length;
  endurance /= teamMembers.length;
  spicyFoodTolerance /= teamMembers.length;

  intelligence = parseFloat(intelligence.toFixed(3));
  strength = parseFloat(strength.toFixed(3));
  endurance = parseFloat(endurance.toFixed(3));
  spicyFoodTolerance = parseFloat(spicyFoodTolerance.toFixed(3));

  return { intelligence, strength, endurance, spicyFoodTolerance };
};
